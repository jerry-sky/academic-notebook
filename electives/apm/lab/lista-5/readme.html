<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl" xml:lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jerry Sky" />
  <title>Lista 5.</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
  </style>
  <link rel="stylesheet" href="/style.css" />
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/katex@0.12.0/dist/katex.min.css" integrity="sha384-AfEj0r4/OFrOo5t7NnNe46zW/tFgW6x/bCJG8FqQCEo3+Aro6EYUG4+cU+KJWu/X" crossorigin="anonymous">
</head>
<body>
<header id="title-block-header">
<h1 class="title">Lista 5.</h1>
<p class="subtitle">Aplikacje mobilne, Laboratorium</p>
<p class="author">
    <span>by </span>
    <span class="author">Jerry Sky</span>
</p>
</header>
<ul>
<li><a href="#zadanie-1">Zadanie 1.</a></li>
<li><a href="#zadanie-2">Zadanie 2.</a>
<ul>
<li><a href="#odnośnie-kwestii-autoryzacji">Odnośnie kwestii autoryzacji</a></li>
</ul></li>
</ul>
<hr />
<h2 id="zadanie-1">Zadanie 1.</h2>
<blockquote>
<p>Napisz prostą dwuwymiarową grę w tenisa Pong lub Arkanoid. Wykorzystaj <code>SurfaceView</code>, który będzie odpowiedzialny za rysowanie gry. Wszystkie informacje o stanie gry mają być przechowywane w bazie SQLite z wykorzystaniem Room-a.</p>
</blockquote>
<p>Pliki projektu znajdują się w katalogu <code>ex-1/Pingouin</code>.</p>
<hr />
<h2 id="zadanie-2">Zadanie 2.</h2>
<blockquote>
<p>Celem tego zadania jest wykorzystanie bazy danych czasu rzeczywistego Firebase. Można wykorzystać ją w dowolnej aplikacji, gdzie jest logowanie na konto i komunikacja czasu rzeczywistego przez sieć.</p>
<p>Przykłady:</p>
<ul>
<li>Dopisz funkcjonalność „gry przez sieć” do aplikacji z Listy 2 - kółko i krzyżyk. Wystarczy tutaj klasyczna rozgrywka na planszy 3×3, czyli na początku mamy możliwość rejestracji lub jeśli mamy już konto to logowania. Po czym możemy wybrać osobę do gry (która jest też zalogowana do systemu). Następnie prowadzimy grę na zmianę przez sieć.</li>
<li>Program do rozmowy (chat) przez sieć z wykorzystaniem Firebase. Logowanie i rozmowa w czasie rzeczywistym z zalogowanymi użytkownikami.</li>
<li>Dopisz możliwość gry przez sieć do zadania 1, czyli np. gry Pong. Logowanie, tabela wyników i oczywiście sama gra prowadzona przez dwie osoby na różnych urządzeniach.</li>
<li>[…] — można napisać dowolną inną, która zawiera komunikację w czasie rzeczywistym oraz logowanie przez Firebase.</li>
</ul>
</blockquote>
<p>Rozwiązanie zawiera prostą aplikację do rozmów między użytkownikami. Każdy(a) użytkownik(czka) musi się zalogować przy pomocy adresu e-mail i hasła.</p>
<p>Pliki projektu znajdują się w katalogu <code>ex-2/Discorde</code>.</p>
<h3 id="odnośnie-kwestii-autoryzacji">Odnośnie kwestii autoryzacji</h3>
<p>Aktualne rozwiązanie nie jest w pełni bezpieczne pod względem podszywania się pod innych użytkowników. Aplikacja sama dołącza pole <code>author</code> do wysyłanej wiadomości — serwer akceptuje tę wartość bez sprawdzania.</p>
<p>Rozwiązaniem byłoby uruchomienie funkcjonalności <em>Firebase Functions</em>, która pozwalałaby na dodanie funkcji nasłuchującej zmian w bazie danych <em>Firebase Realtime DB</em>. Funkcja ta pobierałaby faktyczną nazwę wyświetlaną użytkownika(czki) wysyłającego(ej) wiadomość, a następnie nadpisywała tę wartość wysłaną przez aplikację.</p>
<p>W ten sposób zapewniamy, że wiadomość ma faktyczny podpis tego użytkownika(czki) w bazie danych.</p>
<p>Szkic funkcji:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode ts"><code class="sourceCode typescript"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> functions from <span class="st">&#39;firebase-functions&#39;</span></span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> <span class="op">*</span> <span class="im">as</span> admin from <span class="st">&#39;firebase-admin&#39;</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> { Message } from <span class="st">&#39;../model/message&#39;</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>export const onMessageCreate <span class="op">=</span> functions<span class="op">.</span><span class="at">database</span><span class="op">.</span><span class="fu">ref</span>(<span class="st">&#39;/path&#39;</span>)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>    <span class="op">.</span><span class="fu">onCreate</span>(<span class="fu">async</span> (snap<span class="op">,</span> context) <span class="kw">=&gt;</span> {</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get the message that was created</span></span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>        const message <span class="op">=</span> snap<span class="op">.</span><span class="fu">val</span>() <span class="im">as</span> Message</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get the ID of the user that created the message</span></span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>        const userId <span class="op">=</span> context<span class="op">.</span><span class="at">auth</span><span class="op">.</span><span class="at">uid</span></span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a>        <span class="co">// get the user’s actual display name</span></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>        const userData <span class="op">=</span> await admin<span class="op">.</span><span class="fu">auth</span>()</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>            <span class="op">.</span><span class="fu">getUser</span>(userId)</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>        const userDisplayName <span class="op">=</span> userData<span class="op">.</span><span class="at">displayName</span></span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>        const newMessageValue<span class="op">:</span> <span class="bu">Partial</span><span class="op">&lt;</span>Message<span class="op">&gt;</span> <span class="op">=</span> {</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>            author<span class="op">:</span> userDisplayName</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>        }</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a>        <span class="co">// update the author</span></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>        return snap<span class="op">.</span><span class="at">ref</span><span class="op">.</span><span class="fu">update</span>(newMessageValue)</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>    })</span></code></pre></div>
<p>Oczywiście, w pełnoprawnej aplikacji nie zapisywalibyśmy wyświetlanej nazwy użytkownika, a raczej jego identyfikator (<code>uid</code>). Wówczas serwer mógłby działać w ten sposób, że za każdym razem, kiedy pojawia się nowe zapytanie o listę wiadomości, serwer zwraca listę z zamienionymi <code>uid</code> na nazwy wyświetlane użytkowników.<br />
Nie mielibyśmy wtedy oczywistego problemu duplikowania danych i niepotrzebnej redundancji.</p>
<hr />
</body>
</html>
