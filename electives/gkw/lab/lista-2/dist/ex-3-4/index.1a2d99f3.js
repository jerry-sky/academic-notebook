!function(){class t{constructor(t,e,r){this.x=t,this.y=e,this.z=r}static from(e){return new t(e.x,e.y,e.z)}reset(t){this.x=t?.x||0,this.y=t?.y||0,this.z=t?.z||0}negate(){this.x=-this.x,this.y=-this.y,this.z=-this.z}translate(t){this.x+=t.x,this.y+=t.y,this.z+=t.z}translateY(t){this.y+=t}scale(t){this.x*=t,this.y*=t,this.z*=t}rotateXY(t){const e=Math.sin(t/180*Math.PI),r=Math.cos(t/180*Math.PI),a=this.x*r-this.y*e,n=this.x*e+this.y*r;this.x=a,this.y=n}}class e extends Array{constructor(t){t?super(...t):super(0)}static concatenate(...t){return new e([].concat(...t))}get flatList(){const t=new Array;return this.forEach((e=>{t.push(e.x),t.push(e.y),t.push(e.z)})),t}reset(e){const r=t.from(this[0]);r.negate(),r.translate(e),this.forEach((t=>{t.translate(r)}))}translate(t){this.forEach((e=>{e.translate(t)}))}translateY(t){this.forEach((e=>{e.translateY(t)}))}scale(t){this.forEach((e=>{e.scale(t)}))}rotateXY(t){this.forEach((e=>{e.rotateXY(t)}))}}const r={source:"\nprecision mediump float;\n\nattribute vec3 vertPosition;\n\nvoid main()\n{\n    gl_Position = vec4(vertPosition, 1.0);\n    gl_PointSize = 10.0;\n}\n",attributes:{vertPosition:"vertPosition"}},a={source:"\nprecision mediump float;\n\nuniform vec3 fragColour;\n\nvoid main()\n{\n    gl_FragColor = vec4(fragColour, 1.0);\n}\n",attributes:{},uniforms:{colour:"fragColour"}},n={source:"\nprecision mediump float;\n\nattribute vec3 vertPosition;\nattribute vec2 vertTextureCoordinate;\n\nvarying vec2 fragmentTextureCoordinate;\n\nvoid main()\n{\n    gl_Position = vec4(vertPosition, 1.0);\n    fragmentTextureCoordinate = vertTextureCoordinate;\n}\n",attributes:{vertPosition:"vertPosition",vertTextureCoordinate:"vertTextureCoordinate"}},o={source:"\nprecision mediump float;\n\nuniform sampler2D sampler;\n\nvarying vec2 fragmentTextureCoordinate;\n\nvoid main()\n{\n    gl_FragColor = texture2D(sampler, fragmentTextureCoordinate);\n}\n",attributes:{},uniforms:{colour:"sampler"}};class i{_shapes=[];addShape(t){return this._shapes.push(t)}get shapes(){return this._shapes}resetShapes(){this._shapes=[]}_textureSquares=[];addTextureSquare(t){return this._textureSquares.push(t)}get textureSquares(){return this._textureSquares}constructor(t){if(this.canvas=t,this.gl=this.canvas.getContext("webgl"),this.gl||(this.gl=this.canvas.getContext("experimental-webgl")),!this.gl)throw new Error("WebGL not supported");this.DrawTypes={POINTS:this.gl.POINTS,LINES:this.gl.LINES,LINE_STRIP:this.gl.LINE_STRIP,LINE_LOOP:this.gl.LINE_LOOP,TRIANGLES:this.gl.TRIANGLES,TRIANGLE_STRIP:this.gl.TRIANGLE_STRIP,TRIANGLE_FAN:this.gl.TRIANGLE_FAN},this.clearScreen(),this.prepare(),this.gl.lineWidth(5),this.gl.enable(this.gl.DEPTH_TEST),this.gl.cullFace(this.gl.BACK)}prepare(){const t=this.gl,e=this.prepareShader(r.source,t.VERTEX_SHADER),i=this.prepareShader(a.source,t.FRAGMENT_SHADER);this.program=this.prepareProgram([e,i]);const s=this.prepareShader(n.source,t.VERTEX_SHADER),h=this.prepareShader(o.source,t.FRAGMENT_SHADER);this.programTex=this.prepareProgram([s,h])}clearScreen(){this.gl.clearColor(0,0,0,1),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT)}prepareShader(t,e){const r=this.gl,a=r.createShader(e);if(r.shaderSource(a,t),r.compileShader(a),!this.gl.getShaderParameter(a,this.gl.COMPILE_STATUS))throw new Error("Shader compilation error: "+this.gl.getShaderInfoLog(a));return a}prepareProgram(t){const e=this.gl,r=e.createProgram();if(t.forEach((t=>{e.attachShader(r,t)})),e.linkProgram(r),!e.getProgramParameter(r,e.LINK_STATUS))throw new Error("Program linking error: "+this.gl.getProgramInfoLog(r));if(e.validateProgram(r),!e.getProgramParameter(r,e.VALIDATE_STATUS))throw new Error("Program validating error: "+e.getProgramInfoLog(r));return r}startAnimationLoop(){this.clearScreen(),this._textureSquares.forEach((t=>{this.drawTexturedSquare(t.origin,t.size,t.texture)})),this._shapes.forEach((t=>{this.draw3DUniformColor(t.points,t.drawType,t.colour)})),window.requestAnimationFrame(this.startAnimationLoop.bind(this))}draw3DUniformColor(t,e,n){const o=this.gl,i=o.createBuffer();o.bindBuffer(o.ARRAY_BUFFER,i),o.bufferData(o.ARRAY_BUFFER,new Float32Array(t.flatList),o.STATIC_DRAW);const s=o.getAttribLocation(this.program,r.attributes.vertPosition);o.enableVertexAttribArray(s),o.vertexAttribPointer(s,3,o.FLOAT,!1,3*Float32Array.BYTES_PER_ELEMENT,0),o.useProgram(this.program);const h=o.getUniformLocation(this.program,a.uniforms.colour);o.uniform3fv(h,new Float32Array(n)),o.drawArrays(e,0,t.length)}drawTexturedSquare(t,e,r){const a=this.gl,o=t.x,i=t.y,s=t.z,h=[o,i,s,0,1,o,i+e,s,0,0,o+e,i+e,s,1,0,o+e,i,s,1,1],c=a.createBuffer();a.bindBuffer(a.ARRAY_BUFFER,c),a.bufferData(a.ARRAY_BUFFER,new Float32Array(h),a.STATIC_DRAW);const l=a.getAttribLocation(this.programTex,n.attributes.vertPosition),u=a.getAttribLocation(this.programTex,n.attributes.vertTextureCoordinate);a.vertexAttribPointer(l,3,a.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,0),a.vertexAttribPointer(u,2,a.FLOAT,!1,5*Float32Array.BYTES_PER_ELEMENT,3*Float32Array.BYTES_PER_ELEMENT),a.enableVertexAttribArray(l),a.enableVertexAttribArray(u);const T=a.createTexture();a.bindTexture(a.TEXTURE_2D,T),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_S,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_WRAP_T,a.CLAMP_TO_EDGE),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MIN_FILTER,a.LINEAR),a.texParameteri(a.TEXTURE_2D,a.TEXTURE_MAG_FILTER,a.LINEAR),a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,r),a.useProgram(this.programTex),a.activeTexture(a.TEXTURE0),a.drawArrays(a.TRIANGLE_FAN,0,h.length/5)}}(async()=>{const r=t=>new Promise((e=>{const r=new Image;r.addEventListener("load",(()=>e(r))),r.src=t})),a=document.querySelector("canvas"),n=await r(document.querySelector("img#avatar").src),o=await r(document.querySelector("img#background").src),s=new i(a);s.startAnimationLoop(),s.addTextureSquare({origin:new t(-1,-1,.9),size:2,texture:o}),s.addShape({colour:[.5,.5,.5],drawType:s.DrawTypes.LINE_LOOP,points:new e([new t(-1,-1,-.9),new t(-1,1,-.9),new t(1,1,-.9),new t(1,-1,-.9)])}),s.addShape({colour:[1,0,0],drawType:s.DrawTypes.TRIANGLE_FAN,points:new e([new t(-1,.7,-.4),new t(1,.7,-.4),new t(.5,.4,-.4),new t(-.5,.4,-.4)])});const h=.9;s.addShape({colour:[.4,0,.8],drawType:s.DrawTypes.LINE_LOOP,points:new e([new t(h,-.9,-.6),new t(h,h,-.6),new t(-.9,h,-.6),new t(-.9,-.9,-.6)])});const c=.01,l={colour:[1,1,1],drawType:s.DrawTypes.TRIANGLE_FAN,points:new e([new t(0,0,0),new t(0,.1,0),new t(c,.1,0),new t(c,0,0)])};s.addShape(l),l.points.translate(new t(0,-2,.1));const u={origin:new t(0,0,-.5),size:.15,texture:n};s.addTextureSquare(u),u.origin.translate(new t(0,-1,0));const T=1/8,g=.08,E=[];for(let r=0;r<16;r++){const a={colour:[0,1,0],drawType:s.DrawTypes.TRIANGLE_FAN,points:new e([new t(0,0,0),new t(0,g,0),new t(T,g,0),new t(T,0,0)])};E.push(a),s.addShape(a);const n=Math.floor(r/8);a.points.translate(new t((r-8*n)*T*2-1+.0625,n*g*1.2,0))}let p=!1;let d=0,w=performance.now();!function t(e){const r=e-w;if(w=e,p){l.points.translateY(.001*r),l.points[0].y>1&&(p=!1);const t=l.points[1];for(const e of E){const r=e.points[0];if(r.y<=t.y&&r.x<=t.x&&r.x+T>=t.x){p=!1,e.points.translateY(2),l.points.translateY(2),d++,16===d&&alert("Level cleared. Reload the page to play again.");break}}}window.requestAnimationFrame(t)}(performance.now()),window.addEventListener("keydown",(e=>{switch(e.key){case"ArrowLeft":u.origin.translate(new t(-.1,0,0));break;case"ArrowRight":u.origin.translate(new t(.1,0,0));break;case" ":const e=t.from(u.origin);e.translate(new t(.075-.005,0,.1)),l.points.reset(e),p=!0}}))})()}();
//# sourceMappingURL=index.1a2d99f3.js.map
