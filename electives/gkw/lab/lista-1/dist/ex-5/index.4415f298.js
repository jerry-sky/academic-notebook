!function(){class t{constructor(t,e){this.x=t,this.y=e}}class e extends t{constructor(t,e,s){super(t,e),this.x=t,this.y=e,this.z=s}}class s{static FocalLength=100;static Project3DInto2D(e,n,i){const r=e.x*(s.FocalLength/e.z)+.5*n,o=e.y*(s.FocalLength/e.z)+.5*i;return new t(r,o)}}class n{points=[];constructor(t){this.maxX=t.width,this.minX=0,this.maxY=t.height,this.minY=0,this.rangeX=this.maxX-this.minX,this.rangeY=this.maxY-this.minY,this.context=t.getContext("2d"),this.reset(),this.setToPrimaryColour(),this.context.lineWidth=5}setToPrimaryColour(){this.context.strokeStyle="#000000"}setToSecondaryColour(){this.context.strokeStyle="#ff00ff"}rotateX(t){const s=t/180*Math.PI;this.currentOrientationYZ+=s;const n=Math.cos(s),i=Math.sin(s),r=[...this.points,this._currentPos],o=new e(0,0,0);r.forEach((t=>{const e=(t.y-o.y)*n-(t.z-o.z)*i,s=(t.y-o.y)*i+(t.z-o.z)*n;t.y=e+o.y,t.z=s+o.z}))}rotateY(t){const s=t/180*Math.PI;this.currentOrientationXY+=s;const n=Math.cos(s),i=Math.sin(s),r=[...this.points,this._currentPos],o=new e(0,0,0);r.forEach((t=>{const e=(t.z-o.z)*i-(t.x-o.x)*n,s=(t.z-o.z)*n+(t.x-o.x)*i;t.x=e+o.x,t.z=s+o.z}))}async redraw(){const t=this.context;t.clearRect(this.minX,this.minY,this.rangeX,this.rangeY),this.setToPrimaryColour(),t.moveTo(this.rangeX/2,this.rangeY/2),t.beginPath();for(let e=0;e<this.points.length;e++){const n=s.Project3DInto2D(this.points[e],this.rangeX,this.rangeY);t.lineTo(n.x,n.y)}t.stroke(),t.closePath(),console.log(this.points);const e=s.Project3DInto2D(this._currentPos,this.rangeX,this.rangeY);t.moveTo(e.x,e.y),t.beginPath(),t.arc(e.x,e.y,10,-.75*Math.PI-this.currentOrientationXY,-.25*Math.PI-this.currentOrientationXY),this.setToSecondaryColour(),t.stroke(),t.closePath()}move(t){const s=Math.sin(this.currentOrientationXY)*t;this._currentPos.x+=s;const n=Math.cos(this.currentOrientationXY)*t;this._currentPos.y+=n;const i=Math.sin(this.currentOrientationYZ)*t;this._currentPos.z+=i;const r=this.currentPos.x,o=this.currentPos.y,a=this.currentPos.z;this.points.push(new e(r,o,a))}rotateXY(t){this.currentOrientationXY+=t/180*Math.PI}rotateYZ(t){this.currentOrientationYZ+=t/180*Math.PI}get currentPos(){return this._currentPos}reset(){this._currentPos=new e(0,0,-200),this.currentOrientationXY=0,this.currentOrientationYZ=0,this.points=[],this.points.push(new e(0,0,-200)),this.redraw()}}let i;var r;let o;var a;(r=i||(i={})).FORWARD="F",r.BACKWARD="B",r.LEFT="L",r.RIGHT="R",r.UPWARDS="U",r.DOWNWARDS="D",r.REPEAT="RE",r.PROCEDURE_BEGIN="BE",r.BRACKET_OPEN="[",r.BRACKET_CLOSE="]",r.PROCEDURE_END="EN",r.PROCEDURE_TERMINATE="TE",r.IF="IF",r.CALC="CA",r.EQUALS="=",function(t){const e=Object.keys(i).map((t=>i[t]));t.isOfType=function(t){return-1!==e.indexOf(t)}}(i||(i={})),(a=o||(o={})).DIVIDE="/",a.SUBTRACT="-",a.ADD="+",a.MULTIPLY="*",function(t){const e=Object.keys(o).map((t=>o[t]));t.isOfType=function(t){return-1!==e.indexOf(t)}}(o||(o={}));class c{pointer=0;constructor(t){t&&(this.stack=t.trim().split(/\s|(?<=\[)|(?=\])/))}static from(t){const e=new c;return e.stack=t,e}static copy(t){const e=new c;return e.stack=[...t.stack],e}get isDone(){return this.pointer>this.stack.length-1}get currentElement(){return this.stack[this.pointer]}set currentElement(t){this.stack[this.pointer]=t}pop(){return this.stack[this.pointer++]}popUntil(t){const e=[];let s=this.pointer;for(;s<this.stack.length&&this.stack[s]!==t;)e.push(this.stack[s]),s++;return this.pointer=s,e}popCount(t,e=!1){let s;return e?s=this.stack.splice(this.pointer,t):(s=this.stack.slice(this.pointer,this.pointer+t),this.pointer+=t),s}putBack(t){this.stack.splice(this.pointer,0,...t)}insert(t,e=this.pointer){this.stack.splice(e,0,t)}removePrevious(){this.stack.splice(this.pointer-1,1)}terminate(){this.pointer=this.stack.length}reset(){this.pointer=0}}class h{constructor(t,e){this._stack=t,this._args=e}get stack(){return this._stack}get args(){return this._args}get argCount(){return this._args.length}}const p=t=>parseInt(t,10);class u{procedures={};constructor(t){this.myCanvas=t}handleAtomicAction(t,e){const s=p(e);switch(t){case i.FORWARD:this.myCanvas.move(s);break;case i.BACKWARD:this.myCanvas.move(-1*s);break;case i.LEFT:this.myCanvas.rotateXY(s);break;case i.RIGHT:this.myCanvas.rotateXY(-1*s);break;case i.UPWARDS:this.myCanvas.rotateYZ(s);break;case i.DOWNWARDS:this.myCanvas.rotateYZ(-1*s)}}async ExecuteCommandStack(t){for(this.tokenStack=new c(t),this.preComputeMathExpressions(this.tokenStack);!this.tokenStack.isDone;)await this.handleCommand()}findEndingBracket(t,e){let s=0;const n=e.stack;for(let e=t+1;e<n.length;e++)if(n[e]===i.BRACKET_OPEN)s++;else if(n[e]===i.BRACKET_CLOSE){if(0==s)return e;s--}}computeCondition(t){const e=t[0],s=t[1],n=t[2];switch(s){case i.EQUALS:return e===n}return!1}computeExpression(t){const e=p(t[0]),s=t[1],n=p(t[2]);switch(s){case o.DIVIDE:return e/n;case o.ADD:return e+n;case o.MULTIPLY:return e*n;case o.SUBTRACT:return e-n}}preComputeMathExpressions(t){for(;!t.isDone;){if(t.pop()===i.CALC){const e=t.popCount(3,!0),s=this.computeExpression(e);isNaN(s)?t.putBack(e):(t.insert(String(s)),t.removePrevious())}}t.reset()}async handleCommand(t=this.tokenStack){const e=t.pop();if(e)if(i.isOfType(e))switch(e){case i.BACKWARD:case i.FORWARD:case i.LEFT:case i.RIGHT:case i.UPWARDS:case i.DOWNWARDS:const s=t.pop();"string"==typeof s&&this.handleAtomicAction(e,s);break;case i.REPEAT:const n=t.pop();if("string"==typeof n){const e=p(n)-1,s=t.pointer;t.stack[this.findEndingBracket(s,t)]={index:s,repeat:e}}break;case i.IF:{const e=t.popUntil(i.BRACKET_OPEN);this.computeCondition(e)||t.popUntil(i.BRACKET_CLOSE),t.pop();break}case i.PROCEDURE_BEGIN:{const e=t.pop(),s=p(t.pop()),n=t.popCount(s),r=t.popUntil(i.PROCEDURE_END),o=new h(c.from(r),n);this.procedures[e]=o;break}case i.PROCEDURE_TERMINATE:t.terminate()}else if(Object.keys(this.procedures).includes(e)){const s=this.procedures[e],n=t.popCount(s.argCount),i=c.copy(s.stack);let r=0;for(i.stack.forEach((t=>{if(s.args.includes(t)){const e=s.args.indexOf(t);i.stack[r]=n[e]}r++})),this.preComputeMathExpressions(i);!i.isDone;)await this.handleCommand(i)}else"string"!=typeof e&&(e.repeat>0?(t.pointer=e.index,e.repeat--):(t.pointer--,t.currentElement=i.BRACKET_CLOSE,t.pointer++))}}const l=document.getElementById("execution-form"),E=document.getElementById("command-input"),C=document.getElementById("canvas"),m=document.getElementById("clear-button"),k=document.getElementsByClassName("example-button");if(null!==l&&null!==E&&null!==C&&null!==m){let t=new n(C);t.redraw(),document.addEventListener("keydown",(e=>{switch(e.key){case"ArrowUp":t.rotateX(5);break;case"ArrowDown":t.rotateX(-5);break;case"ArrowLeft":t.rotateY(-5);break;case"ArrowRight":t.rotateY(5)}t.redraw()})),l.onsubmit=e=>{e.preventDefault(),setTimeout((async()=>{const e=E.value,s=new u(t);await s.ExecuteCommandStack(e),await t.redraw()}),50)},m.onclick=e=>{e.preventDefault(),t.reset()};const e=["\nF 10\nR 90\nF 10\nR 90\nF 10\nR 90\nF 10\n        ","\nRE 5 [F 100 R 72]\n        ","\nRE 9 [F 100 R 40]\n        ","\nBE koch 2 :st :a\n    IF :st = 0 [ F :a TE ]\n    koch CA :st - 1 CA :a / 3 R 60\n    koch CA :st - 1 CA :a / 3 L 120\n    koch CA :st - 1 CA :a / 3 R 60\n    koch CA :st - 1 CA :a / 3\nEN\n\n\nBE star 2 :st :a\n    RE 3 [ koch :st :a L 120]\nEN\n\nstar 5 300\n        ","\nBE troj 1 :a\n    RE 3 [F :a R 120]\nEN\n\nBE sierp 2 :n :a\n    IF :n = 0 [troj :a TE]\n    troj :a\n\n    sierp CA :n - 1 CA :a / 2\n    F CA :a / 2\n    sierp CA :n - 1 CA :a / 2\n    R 60\n    F CA :a / 2 R 60\n\n    sierp CA :n - 1 CA :a / 2\n    L 60 B CA :a / 2\n    L 60 B CA :a / 2\nEN\n\nBE sierpinski 2 :n :a\n    R 30\n    sierp :n :a\nEN\n\nsierpinski 5 300\n\n        "];for(let t=0;t<k.length;t++){const s=k[t],n=e[t];s.onclick=t=>{E.value=n}}}}();
//# sourceMappingURL=index.4415f298.js.map
