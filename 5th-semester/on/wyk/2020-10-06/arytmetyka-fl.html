<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="pl" xml:lang="pl">
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="pandoc" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" />
  <meta name="author" content="Jerry Sky" />
  <meta name="dcterms.date" content="2020-10-06" />
  <title>Działania arytmetyczne w arytmetyce fl</title>
  <style type="text/css">
      code{white-space: pre-wrap;}
      span.smallcaps{font-variant: small-caps;}
      span.underline{text-decoration: underline;}
      div.column{display: inline-block; vertical-align: top; width: 50%;}
  </style>
  <link rel="stylesheet" href="/style.css" />
  <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js" type="text/javascript"></script>
  <link rel="preconnect" href="https://fonts.gstatic.com">
  <link href="https://fonts.googleapis.com/css2?family=Merriweather&display=swap" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Fira+Code:wght@500&display=swap" rel="stylesheet">
</head>
<body>
<header id="title-block-header">
<h1 class="title">Działania arytmetyczne w arytmetyce <em>fl</em></h1>
<p class="author">
    <span>by </span>
    <span class="author">Jerry Sky</span>
</p>
<p class="date">2020-10-06</p>
</header>
<h2 id="reprezentacja-liczb-w-fl">1. Reprezentacja liczb w <em>fl</em></h2>
<p><a href="numeryczna-reprezentacja-liczb.md#2-arytmetyka-zmiennopozycyjna-fl">notatka «Numeryczna reprezentacja liczb»</a></p>
<hr />
<h2 id="oznaczenia-działań">2. Oznaczenia działań</h2>
<p>Niech - <span class="math inline">\(x = rd(x)\)</span> - <span class="math inline">\(y = rd(y)\)</span></p>
<p>będą liczbami w arytmetyce <em>fl</em>, wówczas przez <span class="math display">\[
fl(x * y) = fl(x \circledast y)
\]</span> oznaczamy wynik działania <span class="math inline">\(x * y\)</span>, gdzie <span class="math inline">\(* \in \{+, -, /, \cdot\}\)</span>, w arytmetyce <em>fl</em>.</p>
<hr />
<h2 id="przykład">3. Przykład</h2>
<p>Mamy - <span class="math inline">\(\beta = 10\)</span> - <span class="math inline">\(t = 5\)</span> - <span class="math inline">\(x = rd(x) = 0.31426 \cdot 10^3\)</span> - <span class="math inline">\(y = rd(y) = 0.92577 \cdot 10^5\)</span></p>
<p><strong>Używamy akumulatora o podwójnej długości do pośrednich obliczeń.</strong></p>
<p><span class="math display">\[
x + y \overset{\text{po wyrównaniu cech}}{=} 0.9289126000 \cdot 10^5\\ \xrightarrow{\text{zaokrągl.}} fl(x + y) = 0.92891 \cdot 10^5
\]</span> <span class="math display">\[
x - y \overset{\text{po wyrównaniu cech}}{=} -0.9226274000 \cdot 10^5\\ \xrightarrow{\text{zaokrągl.}} fl(x-y) = -0.92263 \cdot 10^5
\]</span> <span class="math display">\[
x \cdot y = 0.2909334802 \cdot 10^8 \xrightarrow{\text{zaokrągl.}} fl(x \cdot y) = 0.29093 \cdot 10^8
\]</span> <span class="math display">\[
\frac{x}{y} \approx 0.3394579647 \cdot 10^{-2} \xrightarrow{\text{zaokrągl.}} fl\left(\frac{x}{y}\right) = 0.33946 \cdot 10^{-2}
\]</span></p>
<h3 id="błędy">3.1. Błędy</h3>
<p>Błędy względne: - <span class="math inline">\(|\delta_+| \approx 2.8 \cdot 10^{-6}\)</span> - <span class="math inline">\(|\delta_-| \approx 2.8 \cdot 10^{-6}\)</span> - <span class="math inline">\(|\delta_{\cdot}| \approx 8.5 \cdot 10^{-6}\)</span> - <span class="math inline">\(|\delta_{/}| \approx 6 \cdot 10^{-6}\)</span></p>
<p>Precyzja arytmetyki:<br />
<span class="math inline">\(\epsilon = 5 \cdot 10^{-5}\)</span></p>
<hr />
<h2 id="przykład-dodawanie-kiedy-x-gg-y">4. Przykład (dodawanie kiedy <span class="math inline">\(x \gg y\)</span>)</h2>
<p>Niech - <span class="math inline">\(x = rd(x) = m_x \beta^{c_x}\)</span> - <span class="math inline">\(y = rd(y) = m_y \beta^{c_y}\)</span> - <span class="math inline">\(x \ge y &gt; 0\)</span> (dla uproszczenia)</p>
<p>Wówczas: <span class="math display">\[
x + y = m_x\beta^{c_x} + m_y \beta^{c_y} = (m_x + m_y\beta^{-(c_x - c_y)}) \beta^{c_x} = m_s \beta^{c_x}
\]</span></p>
<div class="figure">
<img src="3.x-znacznie-większe-od-y-schemat.png" alt="schemat liczb x \gg y" />
<p class="caption">schemat liczb <span class="math inline">\(x \gg y\)</span></p>
</div>
<p>Z powyższego rysunku wynika, że dla <span class="math inline">\(x \gg y\)</span><br />
mamy <span class="math inline">\(fl(x+y) = x\)</span>.</p>
<hr />
<h2 id="warunek-na-błędy">5. Warunek na błędy</h2>
<p>Arytmetyka <em>fl</em> powinna zapewnić równość <span class="math display">\[
fl(x * y) = rd(x*y)
\]</span> dla <span class="math inline">\(* \in \{+, -, /, \cdot\}\)</span> oraz <span class="math inline">\(x * y \in [-\mathrm{MAX};~ \mathrm{MAX}]\)</span>.</p>
<p>Jeśli powyższe jest prawdziwe, to zachodzi równość <span class="math display">\[
fl(x * y) = (x*y)(1 + \delta)
\]</span> gdzie <span class="math inline">\(|\delta| \le \epsilon\)</span>, <span class="math inline">\(\epsilon = 0.5\beta^{1-t}\)</span></p>
<hr />
<h2 id="przykład-narastający-błąd-po-3-działaniach">6. Przykład (narastający błąd po <span class="math inline">\(3\)</span> działaniach)</h2>
<p>Obliczymy <span class="math inline">\(x(y + z)\)</span> w <em>fl</em>. (<span class="math inline">\(x = rd(x)\)</span>, <span class="math inline">\(y = rd(y)\)</span>, <span class="math inline">\(z = rd(z)\)</span>)</p>
<p><span class="math inline">\(fl(x(y+z)) = fl(x \cdot fl(y+z)) = [x \cdot fl(y+z)](1 + \delta_1) = [x(y+z)(1 + \delta_2)](1 + \delta_1) = x(y+z)(1 + \delta_2 + \delta_1 + \delta_2\delta_1) \approx x(y+z)(1+ \delta_2 + \delta_1) = x(y+z)(1+\delta_3)\)</span></p>
<p>gdzie <span class="math inline">\(|\delta_i| \le \epsilon,~ i = 1,2\)</span>, za to <span class="math inline">\(|\delta_3| \le 2\epsilon\)</span></p>
<hr />
<h2 id="twierdzenie1">7. Twierdzenie#1</h2>
<p>Jeśli <span class="math inline">\(\forall i = 1,\dots,n \enspace |\delta_i| \le \epsilon\)</span> oraz <span class="math inline">\(\prod_{i=1}^n(1 + \delta_i) = 1 + E_n\)</span> oraz <span class="math inline">\(n_\epsilon &lt; 2\)</span>, wówczas <span class="math display">\[
|E_n| &lt; \frac{n \epsilon}{1 - 0.5n\epsilon} \approx n\epsilon
\]</span></p>
<h3 id="d-d">7.1. D-d</h3>
<p><span class="math display">\[
\begin{aligned}
|E_n| &amp;= \left|\prod_{i=1}^{n} (1 + \delta_i) - 1\right| \le (1 + \epsilon)^n - 1\\
&amp;= 1 + \binom{n}{1}\epsilon + \binom{n}{2}\epsilon^2 + \binom{n}{3}\epsilon^3 + \dotsb + \binom{n}{n}\epsilon^n - 1\\
&amp;= n\epsilon + \frac{n\epsilon(n-1)\epsilon}{2!} + \frac{n\epsilon(n-1)\epsilon(n-2)\epsilon}{3!} + \dotsb + \frac{n\epsilon(n-1)\epsilon\dotsb1\epsilon}{n!}\\
&amp;= n\epsilon\left( 1 + \frac{(n-1) \epsilon}{2!} + \frac{(n-1)\epsilon(n-2)\epsilon}{3!} + \dotsb +\frac{(n-1) \epsilon \dotsb 1 \epsilon}{n!} \right)\\
&amp;\qquad q = \frac{n\epsilon}{2} &lt; 1\\
|E_n| &amp;&lt; n\epsilon(1 + q + q^2 + \dotsb + q^{n-1}) = n\epsilon \frac{1 - q^n}{1 - q} &lt; \frac{n\epsilon}{1 - 0.5n\epsilon} \approx n\epsilon \quad \blacksquare
\end{aligned}
\]</span></p>
<hr />
<h2 id="przykład-narastający-błąd-po-n-działaniach">8. Przykład (narastający błąd po <span class="math inline">\(n\)</span> działaniach)</h2>
<p>Mamy: - <span class="math inline">\(x_i &gt; 0\)</span>, <span class="math inline">\(i = 0,\dots, n\)</span></p>
<p>Obliczyć: - <span class="math inline">\(S = \sum_{i=0}^n x_i\)</span></p>
<p>Algorytm: 1. <span class="math inline">\(S_0 = x_0\)</span> 2. <code>for</code> <span class="math inline">\(i := 1\)</span> <code>to</code> <span class="math inline">\(n\)</span> <code>do</code>: 1. <span class="math inline">\(S_i := S_{i-1} + x_i\)</span> 3. <code>end for</code></p>
<hr />
<p><span class="math display">\[
\begin{aligned}
fl(S) &amp;= fl(\dots fl(fl(fl(x_0 + x_1) + x_2) + x_3) + \dotsb + x_n)\\
&amp;= (\dots (((x_0 + x_1)(1 + \delta_1) + x_2)(1 + \delta_2) +\\
&amp;+ x_3)(1 + \delta_3) + \dotsb + x_n)(1 + \delta_n)\\
&amp;= x_0 \prod_{i=1}^{n}(1 + \delta_i) + x_1\prod_{i=1}^{n}(1 + \delta_i)+\\
&amp;+ x_2\prod_{i=2}^{n}(1+\delta_i) + x_3\prod_{i=3}^{n}(1+\delta_i) + \dotsb + x_n (1+\delta_n)
\end{aligned}
\]</span> przy czym <span class="math inline">\(|\delta_i| \le \epsilon,~ i = 1,\dots, n\)</span>.</p>
<p>Podstawmy <span class="math inline">\(\prod_{i=k}^{n}(1 + \delta_i) = 1+E_k\)</span>: <span class="math display">\[
\begin{aligned}
fl(S) &amp;= x_0 + x_0E_1 + x_1 + x_1E_1 + x_2 + x_2E_2 + x_3 + x_3E_3 + \dotsb + x_n + x_nE_n\\
&amp;= S + x_0E_1 + x_1E_1 + x_2E_2 + x_3E_3 + \dotsb + x_nE_n\\
&amp;\le S + (x_0 + x_1 + x_2 + x_3 + \dotsb + x_n)\max_{1 \le k \le n} E_k = S(1 + E_1)
\end{aligned}
\]</span> gdzie <span class="math inline">\(|E_1| &lt; n\epsilon\)</span> z <a href="#7-twierdzenie1">«Twierdzenie#1»</a>.</p>
<hr />
<h2 id="redukcja-cyfr-znaczących">9. Redukcja cyfr znaczących</h2>
<p>Przeanalizujmy zjawisko redukcji cyfr znaczących: - <span class="math inline">\(rd(x) = x(1 + \delta_x)\)</span> - <span class="math inline">\(rd(y) = y(1 + \delta_y)\)</span></p>
<p><span class="math display">\[
\frac{|x - y - [rd(x) - rd(y)]|}{|x - y|} = \frac{|\delta_x x - \delta_y y|}{|x - y|} \le \epsilon\frac{|x| + |y|}{|x - y|}
\]</span></p>
<p>Z powyższego oszacowania wynika, że niedokładność danych może przenieść się na wynik z wielkim mnożnikiem <span class="math inline">\(\frac{|x| + |y|}{|x - y|}\)</span> nawet gdy samo działanie nie wprowadza błędu.</p>
<h3 id="przykład-1">9.1. Przykład</h3>
<p>Niech - <span class="math inline">\(x = 0.3721478693\)</span> - <span class="math inline">\(y = 0.3720230572\)</span></p>
<p>(<span class="math inline">\(x \approx y\)</span>)</p>
<p>Różnica dokładna to <span class="math inline">\(x - y = 0.0001248121\)</span>.</p>
<p>Policzymy <span class="math inline">\(x - y\)</span> w arytmetyce <em>fl</em>. - <span class="math inline">\(t = 5\)</span> - <span class="math inline">\(rd(x) = 0.37215\)</span> - <span class="math inline">\(rd(y) = 0.37202\)</span> - <span class="math inline">\(fl(rd(x) - rd(y)) = 0.00013\)</span></p>
<p>Zauważmy, że tutaj mamy <span class="math inline">\(fl(rd(x) - rd(y)) = rd(x) - rd(y)\)</span>.</p>
<p><span class="math inline">\(|\delta| = \frac{|x - y - [rd(x) - rd(y)]|}{|x - y|} = \frac{|0.0001248121 - 0.00013}{|0.0001248121|} \approx 4.16 \cdot 10^{-2}\)</span>.</p>
<p>Precyzja arytmetyki <span class="math inline">\(\epsilon = 5 \cdot 10^{-5}\)</span>.</p>
<hr />
<h3 id="przykład-2">9.2. Przykład</h3>
<p>Gdy liczymy wartość wyrażenia <span class="math inline">\(\sqrt{x^2 + 1} - 1\)</span> kiedy <span class="math inline">\(\bold{|x|}\)</span> <strong>jest mała</strong>.<br />
W tym przypadku następuje redukcja cyfr znaczących.</p>
<p>Przekształćmy <span class="math inline">\(\sqrt{x^2 + 1} - 1\)</span>: <span class="math display">\[
y = (\sqrt{x^2 + 1 } - 1) \frac{\sqrt{x^2 + 1} + 1}{\sqrt{x^2 + 1} + 1} = \frac{x^2}{\sqrt{x^2 + 1} + 1}.
\]</span></p>
<hr />
<h2 id="twierdzenie2">10. Twierdzenie#2</h2>
<p><em>Ile cyfr znaczących tracimy przy odejmowaniu <span class="math inline">\(x - y\)</span>, kiedy <span class="math inline">\(x \approx y\)</span>?</em></p>
<p>Jeśli <span class="math inline">\(x\)</span> i <span class="math inline">\(y\)</span> są dodatnimi liczbami w dwójkowej arytmetyce <em>fl</em> takimi, że <span class="math inline">\(x &gt; y\)</span> oraz <span class="math inline">\(2^{-q} \le 1 - \frac{y}{x} \le 2^{-p}\)</span>, wówczas<br />
tracimy co najmniej <span class="math inline">\(p\)</span> i co najwyżej <span class="math inline">\(q\)</span> bitów przy odejmowaniu.</p>
<h3 id="d-d-1">10.1. D-d</h3>
<p>Niech <span class="math inline">\(x\)</span> oraz <span class="math inline">\(y\)</span> będą dwiema liczbami w dwójkowej arytmetyce <em>fl</em>, czyli <span class="math inline">\(x = m_x 2^{c_x},~ y = m_y 2^{c_y},\)</span>; <span class="math inline">\(m_x, m_y \in \left[\frac{1}{2};~ 1\right)\)</span>.</p>
<p>Ponieważ <span class="math inline">\(x &gt; y\)</span>, to aby obliczyć różnicę <span class="math inline">\(r = x-y\)</span> musimy wyrównać cechy: <span class="math display">\[
r = m_x 2^{c_x} - m_y 2^{c_y} = (m_x - m_y 2^{c_y - c_x})\cdot 2^{c_x} = m_r 2^{c_x}
\]</span></p>
<p>Mantysa <span class="math inline">\(m_r\)</span> spełnia <span class="math display">\[
m_r = (m_x - m_y 2^{c_y - c_x}) = m_x \left( 1 - \frac{m_y 2^{c_y}}{m_x 2^{c_x}} \right) = m_x\left( 1 - \frac{y}{x} \right) &lt; 2^{-p}.
\]</span></p>
<p>Aby znormalizować reprezentację <span class="math inline">\(x - y\)</span> w arytmetyce <em>fl</em>, musimy przesunąć mantysę <span class="math inline">\(m_r\)</span> o co najmniej <span class="math inline">\(p\)</span> bitów w lewo. Wówczas wprowadzone są zera (na prawo), które nie niosą żadnej informacji. Co oznacza redukcję <span class="math inline">\(p\)</span> znaczących bitów.</p>
<p>Rozumowanie dla drugiej części jest podobne.</p>
<hr />
</body>
</html>
